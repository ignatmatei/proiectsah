@model sah.Game
@{
    ViewData["Title"] = "Index";
    var board = Model.board;

}

<h1>Index</h1>
<h2>
@Model.PlayerBlack.name
</h2>
<div>
    <h4>Board</h4>
    <hr />
    <dl class="row">
    </dl>
</div>
<div>

    <table style="width:100%" border="4">
        @{
            for (int i = 8; i >= 1; i--)
            {
                <tr>
                    <td>
                        @i
                    </td>
                    @{
                        for (char m = 'A'; m <= 'H'; m++)
                        {
                            <td id="@(m)@(i)">

                                

                                @{
                                    var p = board.GetPieceFrom(i, (proiect_sah.column)((int)m-64));
                                    if (p != null)
                                    {
                                        
                                        string numeImagine = p.pieceType + ((int)p.Color).ToString();
                                                                <span id="piesa" data-piesa="@p.pieceType">
                                                                 
                                                                    <img src="~/Images/@(numeImagine).png" style="width : 15%" />

                                                                </span>
                                    }
                                }
                            </td>
                        }
                    }
                </tr>
            }
        }

        <tr>
            <td>
            </td>   
            @{
                for (char j = 'A'; j <= 'H'; j++)
                {
                    <td>
                        @j
                    </td>
                }

            }
        </tr>

    </table>
    <h2>
        @Model.PlayerWhite.name
       
    </h2>
    <div>
        Introdu mutarea : ex D2 D4
        <p>

        </p>
        <input id="AllMoveWhite" value="D2 D4" />
        <button onclick="javascript:MoveWhite()">
            Fin move
        </button>
    </div>
</div>
<script>
    function MoveWhite()
    {
        var moveplayer = document.getElementById("AllMoveWhite").value;
        var arr = moveplayer.split(' ');
        var oldparent = document.getElementById(arr[0]);
        var piesa = oldparent.querySelector("#piesa");
        console.log(piesa);
        
        window.alert(moveplayer);
        console.log(arr);
        var urlValid = '/Home/IsValid?first=' + arr[0] + '&last=' + arr[1];
        var last = arr[1].charAt(1);
        
        if (last == '1' || last == '8') {
            if (piesa.dataset.piesa == "Pawn") {

                var promoted = window.prompt("Enter promoted piece");
                urlValid = urlValid + '&pl=' + promoted;
            }
        }
        $.ajax({
            url: urlValid,       
            success: function (data, textStatus, xhr) {
                window.alert('am primit raspuns ' + data);
                if (data) {
                    //TODO: executa mutare
                    
                    console.log(oldparent);
                    var newparent = document.getElementById(arr[1]);
                    var PieceNewParent = newparent.querySelector("#piesa");
                    if (PieceNewParent != null)
                    newparent.removeChild(PieceNewParent);
                    newparent.append(piesa);
                    window.location = window.location;

                }
                else {
                    //spune-i ca nu se face mutarea
                }
                
            }
        });
    }
</script>
